{
  "slug": "qa-e2e-testing",
  "title": "E2E-тестирование с Playwright",
  "description": "Полное руководство по End-to-End тестированию веб-приложений с помощью Playwright: установка, написание тестов и CI-интеграция.",
  "topicSlug": "qa",
  "date": "2026-02-10",
  "readTime": "9 мин",
  "tags": ["QA", "E2E", "Playwright", "Автоматизация", "CI/CD"],
  "content": "\n## Что такое Playwright?\n\n**Playwright** — фреймворк от Microsoft для E2E-тестирования веб-приложений. Он поддерживает Chromium, Firefox и WebKit, позволяя тестировать кроссбраузерно.\n\n### Почему Playwright?\n\n- **Кроссбраузерность** — один тест работает во всех браузерах\n- **Автоожидание** — автоматически ждёт элементы, не нужны `sleep`\n- **Изоляция** — каждый тест в своём контексте браузера\n- **Мощные селекторы** — поиск по тексту, ролям, CSS и XPath\n- **Отладка** — встроенный UI-режим, трассировка и скриншоты\n\n### Установка\n\n```bash\nnpm init playwright@latest\n```\n\nЭта команда создаст конфигурацию и установит нужные браузеры:\n\n```\nplaywright.config.ts\ntests/\n  example.spec.ts\ntests-examples/\n  demo-todo-app.spec.ts\n```\n\n## Конфигурация\n\n```typescript\n// playwright.config.ts\nimport { defineConfig, devices } from '@playwright/test';\n\nexport default defineConfig({\n  testDir: './tests',\n  timeout: 30_000,\n  retries: process.env.CI ? 2 : 0,\n  use: {\n    baseURL: 'http://localhost:3000',\n    trace: 'on-first-retry',\n    screenshot: 'only-on-failure',\n  },\n  projects: [\n    {\n      name: 'chromium',\n      use: { ...devices['Desktop Chrome'] },\n    },\n    {\n      name: 'firefox',\n      use: { ...devices['Desktop Firefox'] },\n    },\n    {\n      name: 'webkit',\n      use: { ...devices['Desktop Safari'] },\n    },\n    {\n      name: 'mobile',\n      use: { ...devices['iPhone 14'] },\n    },\n  ],\n  webServer: {\n    command: 'npm run dev',\n    port: 3000,\n    reuseExistingServer: !process.env.CI,\n  },\n});\n```\n\n## Написание тестов\n\n### Базовый тест\n\n```typescript\nimport { test, expect } from '@playwright/test';\n\ntest('главная страница загружается', async ({ page }) => {\n  await page.goto('/');\n  \n  await expect(page).toHaveTitle(/Frontend Learning Hub/);\n  await expect(\n    page.getByRole('heading', { name: 'Frontend Learning Hub' })\n  ).toBeVisible();\n});\n```\n\n### Навигация и клики\n\n```typescript\ntest('навигация по темам', async ({ page }) => {\n  await page.goto('/');\n  \n  // Клик по ссылке\n  await page.getByRole('link', { name: 'Начать обучение' }).click();\n  \n  // Проверяем URL\n  await expect(page).toHaveURL('/topics');\n  \n  // Проверяем контент\n  await expect(page.getByRole('heading', { name: 'Темы' })).toBeVisible();\n});\n```\n\n### Работа с формами\n\n```typescript\ntest('отправка контактной формы', async ({ page }) => {\n  await page.goto('/contact');\n  \n  // Заполняем форму\n  await page.getByLabel('Имя').fill('Иван Иванов');\n  await page.getByLabel('Email').fill('ivan@example.com');\n  await page.getByLabel('Сообщение').fill('Отличный сайт для обучения!');\n  \n  // Отправляем\n  await page.getByRole('button', { name: 'Отправить сообщение' }).click();\n  \n  // Проверяем результат\n  await expect(\n    page.getByText('Сообщение отправлено!')\n  ).toBeVisible();\n});\n```\n\n### Поиск\n\n```typescript\ntest('поиск статей', async ({ page }) => {\n  await page.goto('/search');\n  \n  const searchInput = page.getByPlaceholder('Поиск статей');\n  await searchInput.fill('React');\n  \n  // Ждём debounce и появления результатов\n  await expect(page.locator('.article-card').first()).toBeVisible();\n  \n  // Проверяем, что все результаты содержат \"React\"\n  const cards = page.locator('.article-card');\n  const count = await cards.count();\n  expect(count).toBeGreaterThan(0);\n});\n```\n\n## Селекторы и локаторы\n\nPlaywright рекомендует использовать **user-facing** локаторы:\n\n```typescript\n// По роли (лучший вариант)\npage.getByRole('button', { name: 'Отправить' });\npage.getByRole('link', { name: 'Главная' });\npage.getByRole('heading', { level: 1 });\n\n// По тексту\npage.getByText('Привет мир');\npage.getByText(/react/i);  // regex\n\n// По label (для форм)\npage.getByLabel('Email');\n\n// По placeholder\npage.getByPlaceholder('Поиск...');\n\n// По test-id (крайний случай)\npage.getByTestId('submit-button');\n\n// CSS (не рекомендуется)\npage.locator('.article-card');\npage.locator('#main-nav a');\n```\n\n## Assertions (проверки)\n\n```typescript\n// Видимость\nawait expect(locator).toBeVisible();\nawait expect(locator).toBeHidden();\n\n// Текст\nawait expect(locator).toHaveText('Точный текст');\nawait expect(locator).toContainText('часть');\n\n// Атрибуты\nawait expect(locator).toHaveAttribute('href', '/about');\nawait expect(locator).toHaveClass(/active/);\n\n// Страница\nawait expect(page).toHaveURL('/topics');\nawait expect(page).toHaveTitle(/Hub/);\n\n// Количество\nawait expect(page.locator('.card')).toHaveCount(6);\n\n// Состояние\nawait expect(locator).toBeEnabled();\nawait expect(locator).toBeDisabled();\nawait expect(locator).toBeChecked();\n```\n\n## Page Object Model\n\nДля масштабных проектов используйте паттерн Page Object:\n\n```typescript\n// pages/TopicsPage.ts\nimport { type Page, type Locator } from '@playwright/test';\n\nexport class TopicsPage {\n  readonly page: Page;\n  readonly heading: Locator;\n  readonly topicCards: Locator;\n\n  constructor(page: Page) {\n    this.page = page;\n    this.heading = page.getByRole('heading', { name: 'Темы' });\n    this.topicCards = page.locator('[data-testid=\"topic-card\"]');\n  }\n\n  async goto() {\n    await this.page.goto('/topics');\n  }\n\n  async selectTopic(name: string) {\n    await this.page.getByRole('link', { name }).click();\n  }\n\n  async getTopicCount() {\n    return this.topicCards.count();\n  }\n}\n```\n\n```typescript\n// tests/topics.spec.ts\nimport { test, expect } from '@playwright/test';\nimport { TopicsPage } from '../pages/TopicsPage';\n\ntest('отображает все темы', async ({ page }) => {\n  const topicsPage = new TopicsPage(page);\n  await topicsPage.goto();\n  \n  await expect(topicsPage.heading).toBeVisible();\n  expect(await topicsPage.getTopicCount()).toBe(7);\n});\n```\n\n## Отладка тестов\n\n```bash\n# UI-режим (интерактивный)\nnpx playwright test --ui\n\n# Headed-режим (видим браузер)\nnpx playwright test --headed\n\n# Пошаговый режим\nnpx playwright test --debug\n\n# Генерация тестов (codegen)\nnpx playwright codegen http://localhost:3000\n\n# Просмотр отчёта\nnpx playwright show-report\n```\n\n## CI/CD интеграция\n\n### GitHub Actions\n\n```yaml\n# .github/workflows/e2e.yml\nname: E2E Tests\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: actions/setup-node@v4\n        with:\n          node-version: 20\n      - run: npm ci\n      - run: npx playwright install --with-deps\n      - run: npx playwright test\n      - uses: actions/upload-artifact@v4\n        if: failure()\n        with:\n          name: playwright-report\n          path: playwright-report/\n```\n\n## Лучшие практики E2E\n\n1. **Тестируйте критические пути** — авторизация, основные CRUD-операции, оплата\n2. **Избегайте хрупких селекторов** — используйте роли и текст, а не CSS-классы\n3. **Изолируйте тесты** — каждый тест должен быть независимым\n4. **Используйте fixtures** — для переиспользования настроек между тестами\n5. **Не переусердствуйте** — E2E тесты дорогие, покрывайте только ключевые сценарии\n\n> **Помните:** E2E тесты — это верхушка пирамиды. Для полноценного покрытия комбинируйте их с юнит- и интеграционными тестами.\n    "
}
